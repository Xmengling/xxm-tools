const pathResolve = require('path').resolve;
const webpack = require('webpack');
const { merge } = require('webpack-merge');
const ora = require('ora');
const commonConfig = require('./webpack.common');

const spinner = ora('开始构建[min]包...').start();

const config = merge(commonConfig, {
  entry: {
    main: pathResolve(__dirname, '../packages/all/lib/all.ts')
  },
  output: {
    path: pathResolve(__dirname, '../packages/all/dist'),
    filename: '[name].min.js',
    library: {
      type: 'umd',
      name: 'all',
    },
    globalObject: 'this',
  },
  optimization: {
    minimize: true,
  },
});
webpack(config, (err, stats) => {
  if (err || stats.hasErrors()) {
    spinner.fail(`构建失败`);
    console.error(
      stats.toString({
        chunks: false,
        colors: true,
      }),
    );
    return;
  }
  spinner.succeed(`构建成功`);
});